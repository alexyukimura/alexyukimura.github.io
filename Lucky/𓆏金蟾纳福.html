<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ğ“†é‡‘èŸ¾çº³ç¦</title>
    <style>
        body {
            background-color: #2a1e1a;
            color: #e0d4c0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'å®‹ä½“', serif;
        }

        .altar {
            font-size: 6rem;
            margin: 1rem 0;
            text-shadow: 0 0 10px #ffaa33;
        }

        .platform {
            width: 80%;
            max-width: 800px;
            min-height: 300px;
            background: #3a2c25;
            border: 3px solid #5a4a42;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .offering {
            position: absolute;
            font-size: 2.5rem;
            transition: transform 0.3s;
            cursor: pointer;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
        }

        .offering:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .controls {
            display: flex;
            gap: 2rem;
            margin: 20px 0;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            background: #6b4f3a;
            color: #ffe8c2;
        }

        button:disabled {
            background: #44362d !important;
            color: #7a6659 !important;
            cursor: not-allowed;
        }

        button.active {
            background: #9c6f4c;
            box-shadow: 0 0 15px #ff9933;
        }

        .counter {
            margin-top: 1rem;
            font-size: 1.1rem;
            color: #c0a080;
        }

        #timer {
            color: #ff9966;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="altar">ğ“†</div>
    <div id="customAlert" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2a1e1a; padding: 20px; border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); z-index: 1000; text-align: center;">
        <p id="alertMessage"></p>
        <button onclick="closeCustomAlert()" style="margin: 10px auto; display: block;">ç¡®å®š</button>
    </div>
    <div class="controls">
        <button id="incenseBtn" onclick="offer('incense')">ğŸ•¯ æ™¨é¦™</button>
        <button id="fruitBtn" onclick="offer('fruit')">ğŸ é²œæœ</button>
    </div>

    <div class="platform" id="platform"></div>

    <div class="counter">
        ä»Šæ—¥å·²ä¾›ï¼š<span id="todayCount">0</span> æ¬¡ |
        ç´¯è®¡ä¾›å“ï¼š<span id="totalCount">0</span> æ¬¡
        <div id="timer"></div>
    </div>

    <script>
        let offerings = [];
        const STORAGE_KEY = "sacrificialData";
        const MAX_DAILY = 1;

        // åˆå§‹åŒ–åŠ è½½
        function init() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                offerings = data.offerings || [];
                updateCounters();
                renderOfferings();
                checkDailyLimit();
            }
            updateTimer();
            setInterval(updateTimer, 1000);
        }

        // ä¾›å¥‰æ“ä½œ
        function offer(type) {
            if (!canOffer()) return;

            const offering = {
                type: type,
                emoji: type === 'incense' ? 'ğŸ•¯' : 'ğŸ',
                date: new Date().toISOString(),
                position: {
                    x: Math.random() * 80 + 10,
                    y: Math.random() * 70 + 15
                }
            };

            offerings.push(offering);
            saveData();
            renderOfferings();
            updateCounters();
        }

        // æ¸²æŸ“ä¾›å“
        function renderOfferings() {
            const platform = document.getElementById('platform');
            platform.innerHTML = '';
            
            offerings.forEach(offer => {
                const elem = document.createElement('div');
                elem.className = 'offering';
                elem.style.left = `${offer.position.x}%`;
                elem.style.top = `${offer.position.y}%`;
                elem.innerHTML = offer.emoji;
                platform.appendChild(elem);
            });
        }

        // æ£€æŸ¥æ¯æ—¥é™åˆ¶
        function canOffer() {
            const today = new Date().toDateString();
            const todayOffers = offerings.filter(o => 
                new Date(o.date).toDateString() === today
            ).length;
            
            if (todayOffers >= MAX_DAILY) {
                showCustomAlert('ä»Šæ—¥ä¾›å¥‰å·²è¾¾ä¸Šé™ï¼Œè¯·æ˜æ—¥å†æ¥ï¼Œè½¬ç»™æœ‹å‹ï¼Œè®©é‡‘èŸ¾ä¸ºä»–ä»¬çº³ç¦ï¼Œå¸¦æ¥è´¢è¿');
                return false;
            }
            return true;
        }

        // æ›´æ–°è®¡æ•°å™¨
        function updateCounters() {
            const today = new Date().toDateString();
            const todayCount = offerings.filter(o => 
                new Date(o.date).toDateString() === today
            ).length;
            
            document.getElementById('todayCount').textContent = todayCount;
            document.getElementById('totalCount').textContent = offerings.length;
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                offerings: offerings,
                lastUpdate: new Date().toISOString()
            }));
        }

        // æ›´æ–°å€’è®¡æ—¶
        function updateTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const diff = tomorrow - now;
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            
            document.getElementById('timer').textContent = 
                `é‡ç½®å€’è®¡æ—¶ï¼š${hours}å°æ—¶${minutes}åˆ†`;
        }

        function showCustomAlert(message) {
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('customAlert').style.display = 'block';
        }

        function closeCustomAlert() {
            document.getElementById('customAlert').style.display = 'none';
        }

        function shareContent() {
            const shareText = 'ä»Šæ—¥ä¾›å¥‰å·²è¾¾ä¸Šé™ï¼Œè¯·æ˜æ—¥å†æ¥ï¼Œè½¬ç»™æœ‹å‹ï¼Œè®©é‡‘èŸ¾ä¸ºä»–ä»¬çº³ç¦ï¼Œå¸¦æ¥è´¢è¿';
            const pageLink = window.location.href;

            if (navigator.share) {
                navigator.share({
                    title: 'é‡‘èŸ¾çº³ç¦',
                    text: shareText,
                    url: pageLink
                })
                .then(() => console.log('åˆ†äº«æˆåŠŸ'))
                .catch((error) => console.error('åˆ†äº«å¤±è´¥:', error));
            } else {
                // ä¸æ”¯æŒ navigator.share æ—¶ï¼Œä½¿ç”¨å‰ªè´´æ¿æ–¹å¼
                const shareContent = `${shareText}\n${pageLink}`;
                navigator.clipboard.writeText(shareContent)
                    .then(() => {
                        alert('åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    })
                    .catch((error) => {
                        console.error('å¤åˆ¶å¤±è´¥:', error);
                        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å†…å®¹ã€‚');
                    });
            }
        }
        // åˆå§‹åŒ–æ‰§è¡Œ
        init();
    </script>
</body>
</html>
