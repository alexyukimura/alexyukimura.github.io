<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>ç«çœ¼é‡‘ç›æŒ‘æˆ˜ï¼šæ‰¾å‡ºä¸åŒæ±‰å­—ï¼ä½ èƒ½å‡ ç§’å®Œæˆï¼Ÿ</title>
    <style>
        :root {
            --cell-bg: #fff;
            --cell-border: #b0c4de;
            --cell-text: #2d3a4b;
            --cell-hover-bg: #d0e6fa;
            --cell-hover-text: #e94f4a;
            --cell-shadow: #d0d0d0;
            --cell-hover-shadow: #b0c4de;
        }
        html {
            font-size: 16px;
        }
        body {
            font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
            background: #f2f6f9;
            text-align: center;
            margin: 0;
            padding: 0;
            transition: background-color 0.5s ease;
        }
        #main-title {
            margin-top: 2.5rem;
            font-size: 2.4rem;
            font-weight: bold;
            letter-spacing: 3px;
            padding: 0 1rem;
            word-break: break-all;
            background: linear-gradient(45deg, #ff6b6b, #4a90e2, #ffb300);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGradient 3s ease infinite, titleGlow 2s infinite alternate;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        #main-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ff6b6b, #4a90e2, transparent);
            border-radius: 3px;
            animation: titleLine 3s ease infinite;
        }
        @keyframes titleGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes titleGlow {
            0% { filter: drop-shadow(0 0 2px rgba(233, 79, 74, 0.3)); }
            50% { filter: drop-shadow(0 0 8px rgba(74, 144, 226, 0.6)); }
            100% { filter: drop-shadow(0 0 2px rgba(255, 179, 0, 0.3)); }
        }
        @keyframes titleLine {
            0% { opacity: 0.3; transform: translateX(-50%) scaleX(0.8); }
            50% { opacity: 1; transform: translateX(-50%) scaleX(1); }
            100% { opacity: 0.3; transform: translateX(-50%) scaleX(0.8); }
        }
        #timer-tip-wrap {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1.2rem;
            margin-bottom: 0.5rem;
            gap: 1.2rem;
        }
        .timer-wrap {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            position: relative;
        }
        .timer-icon {
            width: 2.8rem;
            height: 2.8rem;
            background: linear-gradient(135deg, #fff 0%, #f0f4f8 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(176, 196, 222, 0.4),
                        inset 0 -2px 4px rgba(0, 0, 0, 0.05);
            animation: float 2s ease-in-out infinite;
            font-size: 1.5rem;
            position: relative;
            transition: transform 0.3s ease;
        }
        .timer-icon::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            border-radius: 50%;
            z-index: -1;
            opacity: 0.2;
            animation: pulse 2s ease-in-out infinite;
        }
        .timer-icon:hover {
            transform: scale(1.1);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-5px) rotate(5deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.2; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }
        #timer {
            font-size: 1.3rem;
            color: #357abd;
            font-weight: bold;
            letter-spacing: 1px;
            display: inline-block;
            vertical-align: middle;
            background: linear-gradient(135deg, #fff 0%, #f0f4f8 100%);
            border-radius: 0.7rem;
            padding: 0.4rem 1.2rem;
            box-shadow: 0 4px 12px rgba(176, 196, 222, 0.4),
                        inset 0 -2px 4px rgba(0, 0, 0, 0.05);
            position: relative;
            transition: transform 0.3s ease;
        }
        #timer:hover {
            transform: translateY(-2px);
        }
        #find-tip {
            display: inline-block;
            font-size: 1.25rem;
            color: #fff;
            background: linear-gradient(90deg, #ffb300 60%, #ff5252 100%);
            font-weight: bold;
            border-radius: 1.2rem;
            padding: 0.5rem 1.6rem;
            box-shadow: 0 4px 16px #ffd60099;
            letter-spacing: 2px;
            vertical-align: middle;
            text-shadow: 1px 1px 8px #ffecb3, 0 2px 8px #e94f4a;
            border: 2.5px solid #fffbe6;
            margin: 0;
            overflow: hidden;
        }
        #find-tip span {
            display: inline-block;
            animation: scale 1.5s infinite ease-in-out;
        }
        .find-tip-movein {
            animation: moveInRight 0.7s cubic-bezier(.68,-0.55,.27,1.55);
        }
        @keyframes moveInRight {
            0% { transform: translateX(120%); opacity: 0; }
            80% { transform: translateX(-8%); opacity: 1; }
            100% { transform: translateX(0); opacity: 1; }
        }
        @keyframes scale {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        #game-board {
            display: inline-block;
            margin: 2rem auto 0 auto;
            border: 2px solid #4a90e2;
            background: #e3eaf2;
            border-radius: 1rem;
            box-shadow: 0 2px 16px #b0c4de;
            padding: 1.2rem 0.5rem 0.8rem 0.5rem;
            max-width: 98vw;
            transition: all 0.5s ease;
        }
        .row {
            display: flex;
            justify-content: center;
        }
        .cell {
            width: 2.4rem;
            height: 2.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            border: 1.5px solid var(--cell-border);
            cursor: pointer;
            background: var(--cell-bg);
            color: var(--cell-text);
            margin: 0.15rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 1px 4px var(--cell-shadow);
            user-select: none;
        }
        .cell:hover, .cell:active {
            background: var(--cell-hover-bg);
            color: var(--cell-hover-text);
            box-shadow: 0 2px 8px var(--cell-hover-shadow);
        }
        .center-btn {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #restart {
            margin-top: 1.2rem;
            margin-bottom: 0.5rem;
            padding: 0.8rem 2.2rem;
            font-size: 1.1rem;
            background: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 0.6rem;
            cursor: pointer;
            box-shadow: 0 2px 8px #b0c4de;
            font-weight: bold;
            letter-spacing: 2px;
            transition: background 0.2s;
            display: inline-block;
        }
        #restart:hover, #restart:active {
            background: #357abd;
        }
        #popup {
            display: none;
            position: fixed;
            left: 50%;
            top: 40%;
            transform: translate(-50%, -50%);
            background: #fffbe6;
            color: #e94f4a;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 1rem;
            box-shadow: 0 4px 32px #b0c4de;
            padding: 1.5rem 2.2rem;
            z-index: 9999;
            animation: popupShow 0.5s;
            max-width: 90vw;
            word-break: break-all;
        }
        @keyframes popupShow {
            0% { opacity: 0; transform: scale(0.7) translate(-50%, -50%);}
            100% { opacity: 1; transform: scale(1) translate(-50%, -50%);}
        }
        @media (max-width: 600px) {
            html { font-size: 18px; }
            #main-title { font-size: 1.8rem; }
            #timer-tip-wrap {
                flex-direction: column;
                gap: 0.7rem;
            }
            .timer-icon {
                width: 2.4rem;
                height: 2.4rem;
                font-size: 1.3rem;
            }
            #timer {
                font-size: 1.1rem;
                padding: 0.35rem 1.1rem;
            }
            #find-tip {
                font-size: 1.05rem;
                padding: 0.35rem 1.1rem;
                border-radius: 0.8rem;
            }
            #game-board { 
                padding: 1rem 0.3rem 1rem 0.3rem;
                max-width: 95vw;
            }
            .cell { 
                width: 2.2rem; 
                height: 2.2rem; 
                font-size: 1.6rem;
                margin: 0.12rem;
            }
            #restart { font-size: 1.3rem; padding: 1rem 2rem; }
            #popup { font-size: 1.5rem; padding: 1.5rem 2rem; }
        }
    </style>
</head>
<body>
    <h1 id="main-title">ç«çœ¼é‡‘ç›æŒ‘æˆ˜ï¼šæ‰¾å‡ºä¸åŒæ±‰å­—ï¼ä½ èƒ½å‡ ç§’å®Œæˆï¼Ÿ</h1>
    <div id="timer-tip-wrap">
        <div class="timer-wrap">
            <div class="timer-icon">â±ï¸</div>
            <div id="timer">ç”¨æ—¶ï¼š0.00 ç§’</div>
        </div>
        <span id="find-tip">æ‰¾å‡ºå›¾ä¸­"<span>é’±</span>"</span>
    </div>
    <div id="game-board"></div>
    <div class="center-btn">
        <button id="restart" onclick="startGame()">é‡æ–°å¼€å§‹</button>
    </div>
    <div id="popup"></div>
    
    <!-- å…ˆåŠ è½½å­—åº“ -->
    <script src="./charPairs.js"></script>
    
    <!-- ç„¶ååŠ è½½æ¸¸æˆé€»è¾‘ -->
    <script>
        // ç¡®ä¿å­—åº“å·²åŠ è½½
        if (!window.charPairs || !window.charPairs.length) {
            console.error('å­—åº“åŠ è½½å¤±è´¥ï¼');
            document.getElementById('popup').textContent = 'æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
            document.getElementById('popup').style.display = 'block';
            throw new Error('å­—åº“åŠ è½½å¤±è´¥');
        }

        const gridSize = 8;
        let normalChar = "ç›®";
        let diffChar = "æ—¥";
        let timerInterval = null;
        let startTime = null;
        let timerStopped = false;

        // èƒŒæ™¯è‰²
        const backgroundColors = [
            '#2C3E50', // æ·±è“ç°
            '#1A1A2E', // æ·±è“é»‘
            '#16213E', // æ·±æµ·å†›è“
            '#1B262C', // æ·±é’ç°
            '#2D3436', // æ·±ç°
            '#2C1810', // æ·±æ£•
            '#1B1B2F', // æ·±ç´«è“
            '#1A1A1A'  // çº¯é»‘
        ];
        // å¯¹åº”è¾¹æ¡†è‰²
        const borderColors = [
            '#E74C3C', // é²œçº¢
            '#00B894', // è–„è·ç»¿
            '#FDCB6E', // æ˜é»„
            '#0984E3', // å¤©è“
            '#6C5CE7', // ç´«è‰²
            '#FF7675', // çŠç‘šçº¢
            '#00CEC9', // é’ç»¿
            '#FFA502'  // æ©™è‰²
        ];
        // æ ¼å­åº•è‰²
        const cellBgColors = [
            ['#FFE4E1', '#FFB6C1', '#FFC0CB', '#FFA07A', '#FFDAB9'], // ç²‰çº¢ç³»
            ['#98FB98', '#90EE90', '#7FFFD4', '#66CDAA', '#20B2AA'], // æ¸…æ–°ç»¿ç³»
            ['#FFD700', '#FFA500', '#FF8C00', '#FF7F50', '#FF6347'], // é‡‘æ©™ç³»
            ['#87CEEB', '#00BFFF', '#1E90FF', '#4169E1', '#6495ED'], // å¤©è“ç³»
            ['#DDA0DD', '#EE82EE', '#DA70D6', '#BA55D3', '#9370DB'], // ç´«è‰²ç³»
            ['#F0E68C', '#FFD700', '#FFA500', '#FF8C00', '#FF7F50'], // é‡‘é»„ç³»
            ['#E6E6FA', '#D8BFD8', '#DDA0DD', '#EE82EE', '#DA70D6'], // æ·¡ç´«ç³»
            ['#B0E0E6', '#87CEEB', '#00BFFF', '#1E90FF', '#4169E1']  // æ·¡è“ç³»
        ];
        // æ ¼å­è¾¹æ¡†è‰²
        const cellBorderColors = [
            '#BDC3C7', // æµ…ç°
            '#DFE4EA', // æ·¡ç°
            '#DCDDE1', // é“¶ç°
            '#F1F2F6', // æ·¡ç°ç™½
            '#DFE4EA', // æ·¡ç°
            '#DCDDE1', // é“¶ç°
            '#F1F2F6', // æ·¡ç°ç™½
            '#DFE4EA'  // æ·¡ç°
        ];
        // æ ¼å­æ–‡å­—è‰²
        const cellTextColors = [
            '#2C3E50', // æ·±è“ç°
            '#1A1A2E', // æ·±è“é»‘
            '#16213E', // æ·±æµ·å†›è“
            '#1B262C', // æ·±é’ç°
            '#2D3436', // æ·±ç°
            '#2C1810', // æ·±æ£•
            '#1B1B2F', // æ·±ç´«è“
            '#1A1A1A'  // çº¯é»‘
        ];
        // æ ¼å­æ‚¬åœèƒŒæ™¯è‰²
        const cellHoverBgColors = [
            '#E74C3C', // é²œçº¢
            '#00B894', // è–„è·ç»¿
            '#FDCB6E', // æ˜é»„
            '#0984E3', // å¤©è“
            '#6C5CE7', // ç´«è‰²
            '#FF7675', // çŠç‘šçº¢
            '#00CEC9', // é’ç»¿
            '#FFA502'  // æ©™è‰²
        ];
        // æ ¼å­æ‚¬åœæ–‡å­—è‰²
        const cellHoverTextColors = [
            '#FFFFFF', // çº¯ç™½
            '#FFFFFF', // çº¯ç™½
            '#FFFFFF', // çº¯ç™½
            '#FFFFFF', // çº¯ç™½
            '#FFFFFF', // çº¯ç™½
            '#FFFFFF', // çº¯ç™½
            '#FFFFFF', // çº¯ç™½
            '#FFFFFF'  // çº¯ç™½
        ];
        // æ ¼å­é˜´å½±è‰²
        const cellShadowColors = [
            '#95A5A6', // ä¸­ç°
            '#B2BEC3', // æµ…ç°
            '#A4B0BE', // æ·¡ç°
            '#B2BEC3', // æµ…ç°
            '#95A5A6', // ä¸­ç°
            '#B2BEC3', // æµ…ç°
            '#A4B0BE', // æ·¡ç°
            '#B2BEC3'  // æµ…ç°
        ];
        // æ ¼å­æ‚¬åœé˜´å½±è‰²
        const cellHoverShadowColors = [
            '#C0392B', // æ·±çº¢
            '#00A884', // æ·±è–„è·ç»¿
            '#E6B84C', // æ·±é»„
            '#0873C4', // æ·±è“
            '#5B4BC4', // æ·±ç´«
            '#E65C5B', // æ·±çŠç‘šçº¢
            '#00B5B0', // æ·±é’ç»¿
            '#E69400'  // æ·±æ©™
        ];

        let bestTime = localStorage.getItem('bestTime') || Infinity;
        let achievementUnlocked = false;

        function getRandomInt(max) {
            return Math.floor(Math.random() * max);
        }

        function updateBackgroundColor() {
            const index = getRandomInt(backgroundColors.length);
            const randomColor = backgroundColors[index];
            const randomBorderColor = borderColors[index];
            
            // æ›´æ–°èƒŒæ™¯è‰²
            document.body.style.backgroundColor = randomColor;
            
            // æ›´æ–°æ¸¸æˆåŒºåŸŸæ ·å¼
            const board = document.getElementById('game-board');
            board.style.borderColor = randomBorderColor;
            board.style.boxShadow = `0 2px 16px ${randomBorderColor}40`;
            board.style.background = `${randomColor}dd`;
            
            // æ›´æ–°CSSå˜é‡
            document.documentElement.style.setProperty('--cell-bg', cellBgColors[index]);
            document.documentElement.style.setProperty('--cell-border', cellBorderColors[index]);
            document.documentElement.style.setProperty('--cell-text', cellTextColors[index]);
            document.documentElement.style.setProperty('--cell-hover-bg', cellHoverBgColors[index]);
            document.documentElement.style.setProperty('--cell-hover-text', cellHoverTextColors[index]);
            document.documentElement.style.setProperty('--cell-shadow', cellShadowColors[index]);
            document.documentElement.style.setProperty('--cell-hover-shadow', cellHoverShadowColors[index]);
        }

        function startTimer() {
            startTime = Date.now();
            timerStopped = false;
            document.getElementById('timer').textContent = 'ç”¨æ—¶ï¼š0.00 ç§’';
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (timerStopped) return;
                const elapsed = (Date.now() - startTime) / 1000;
                document.getElementById('timer').textContent = `ç”¨æ—¶ï¼š${elapsed.toFixed(2)} ç§’`;
            }, 50);
        }

        function stopTimer() {
            timerStopped = true;
            if (timerInterval) clearInterval(timerInterval);
        }

        function showPopup(msg) {
            const popup = document.getElementById('popup');
            popup.textContent = msg;
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 1800);
        }

        function startGame() {
            try {
                document.getElementById('game-board').innerHTML = '';
                updateBackgroundColor();

                // éšæœºé€‰æ‹©ä¸€ç»„æ±‰å­—
                const pair = window.charPairs[getRandomInt(window.charPairs.length)];
                if (!pair || pair.length !== 2) {
                    throw new Error('æ— æ•ˆçš„æ±‰å­—å¯¹');
                }
                normalChar = pair[0];
                diffChar = pair[1];

                // åŠ¨æ€æ›´æ–°æç¤ºå†…å®¹å¹¶åŠ å³ä¾§ç§»å…¥åŠ¨ç”»
                const findTip = document.getElementById('find-tip');
                if (findTip) {
                    findTip.innerHTML = `æ‰¾å‡ºå›¾ä¸­"<span>${diffChar}</span>"`;
                    findTip.classList.remove('find-tip-movein');
                    // è§¦å‘é‡ç»˜
                    void findTip.offsetWidth;
                    findTip.classList.add('find-tip-movein');
                }

                // éšæœºç”Ÿæˆä¸åŒå­—çš„ä½ç½®
                const diffRow = getRandomInt(gridSize);
                const diffCol = getRandomInt(gridSize);

                // è·å–å½“å‰é…è‰²æ–¹æ¡ˆ
                const colorIndex = getRandomInt(backgroundColors.length);
                const currentCellBgs = cellBgColors[colorIndex];

                startTimer();

                for (let i = 0; i < gridSize; i++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'row';
                    for (let j = 0; j < gridSize; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.textContent = (i === diffRow && j === diffCol) ? diffChar : normalChar;
                        // éšæœºé€‰æ‹©å½“å‰é…è‰²æ–¹æ¡ˆä¸­çš„ä¸€ä¸ªèƒŒæ™¯è‰²
                        cell.style.backgroundColor = currentCellBgs[getRandomInt(currentCellBgs.length)];
                        cell.onclick = function() {
                            if (timerStopped) return;
                            if (i === diffRow && j === diffCol) {
                                handleGameWin();
                            }
                        };
                        rowDiv.appendChild(cell);
                    }
                    document.getElementById('game-board').appendChild(rowDiv);
                }
            } catch (error) {
                console.error('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:', error);
                showPopup('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        function handleGameWin() {
            const currentTime = (Date.now() - startTime) / 1000;
            stopTimer();
            if (currentTime < bestTime) {
                bestTime = currentTime;
                localStorage.setItem('bestTime', bestTime);
                showPopup('ğŸ‰ æ–°çºªå½•ï¼ä½ æ˜¯æœ€å¿«çš„ï¼');
            }
            let message = '';
            if (currentTime < 8) {
                message = 'å¤ªå‰å®³äº†ï¼ä½ æ˜¯ç«çœ¼é‡‘ç›ï¼';
            } else if (currentTime < 15) {
                message = 'ä¸é”™ï¼ä½ çš„çœ¼åŠ›å¾ˆå¥½ï¼';
            } else {
                message = 'ç»§ç»­åŠ æ²¹ï¼';
            }
            showPopup(message);
        }

        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨æ¸¸æˆ
        window.onload = function() {
            try {
                startGame();
            } catch (error) {
                console.error('æ¸¸æˆå¯åŠ¨å¤±è´¥:', error);
                showPopup('æ¸¸æˆå¯åŠ¨å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        };
    </script>
</body>
</html>